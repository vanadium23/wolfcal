# fn-11-01z.2 Update decrypt() for backward compatibility

## Description
Update `decrypt()` to handle both old (double-base64 JSON) and new (binary) formats.

**Size:** M
**Files:** `src/lib/config/transferCrypto.ts`

### Approach

At `transferCrypto.ts:116-150`, modify `decrypt()`:

1. Detect format by checking first character after base64 decode:
   - If starts with `{` → old JSON format (parse as before)
   - If starts with `0x01` → new binary format (version 1)

2. For new format:
   - Decode base64url to bytes
   - Extract: version (1 byte), salt (16 bytes), iv (12 bytes), ciphertext (rest)
   - Decrypt ciphertext
   - Decompress result

3. Add `decompressData()` helper using DecompressionStream API

### Key context

- Must not break existing exported URLs that haven't been imported yet
- Old format detection: `atob(data)[0] === '{'` or try JSON.parse
- DecompressionStream mirrors CompressionStream API
## Acceptance
- [ ] Old format URLs (double-base64 JSON) still decrypt correctly
- [ ] New format URLs (binary) decrypt correctly
- [ ] Invalid/corrupted data throws descriptive error
- [ ] Format detection is reliable (no false positives)
## Done summary
Updated decrypt() function to support both old (double-base64 JSON) and new (binary compressed) formats for backward compatibility. Added decompressData() helper using DecompressionStream API, implemented format detection by checking first byte, and updated tests to expect base64url encoding.
## Evidence
- Commits: 1576db0980947f4a34d50b5cbd5a1f12b31ee565
- Tests: npm test -- src/test/config/transferCrypto.test.ts, npm run build
- PRs: